# TRD-002: 协议与通信约束（对应 BRN-002）
1) 协议：统一使用 Protobuf 作为数据契约，HTTP/JSON 封装，保留 gRPC 扩展口。
2) SSOT：`libs/schema` 为唯一源，生成代码供前端/后端/回归共享，禁止修改生成物。
3) 传输：HTTPS，必含 `schema_version`、symbol 等参数；响应为 Proto 序列化 payload。
4) 兼容：Schema 语义化版本，破坏性变更需兼容旧客户端（双写/灰度）。
5) 依赖：后端必须校验/反序列化；前端打包同版本生成物；回归用同一 DTO。
6) 健康：`/api/ping` 返回 200+版本；`/health` 可选带子组件状态。
7) 安全与缓存：信任一层代理，校验 `X-Forwarded-*`；API 不缓存，鉴权/限流在反代或后端。
8) 监控：错误码/耗时打点入 `x-log/`；异常请求保留摘要。
9) 发布：上线前跑 `backend:test` 和 `regression:*`；破坏性变更需回滚方案。

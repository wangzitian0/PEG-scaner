# 基建 / 自动化变更 Workflow

适用：CI/CD、开发脚本、容器/Compose、运行环境、监控告警、成本优化等基建类变更。

## 开始前的分析方法
- 明确变更目的：性能、成本、安全、可观测性、开发效率。
- 识别影响面：环境变量、Secret、端口、依赖服务、缓存/存储路径。
- 列出回滚方案与停机/切换窗口，估计风险等级。
- 审视运行成本：资源占用、构建时间、带宽/存储费用。

## 必须阅读的文档
- `AGENTS.md`、`docs/README.md`、相关目录 README
- 相关 IRD（如 `docs/specs/infra/IRD-004.env_eaas_infra.md`）
- 受影响脚本/配置（`tools/`, `docker-compose*.yml`, CI workflows）
- 目标环境契约：`.env.ci`、环境变量约定

## 流程 checklist
- [ ] 定义成功标准与回滚条件。
- [ ] 盘点受影响的服务/脚本/环境变量与默认值。
- [ ] 设计方案：拓扑/流水线/权限/资源配额。
- [ ] 编码/配置变更，保留可观测性与日志。
- [ ] 本地/CI 验证：相关脚本、流水线、容器启动/停止。
- [ ] 安全检查：凭据最小化、路径权限、网络暴露面。
- [ ] 更新文档：README、IRD、运维说明、环境变量列表。
- [ ] 准备回滚步骤和后续监控点。

## 流程的强制约束
- 不引入未声明的环境变量（契约只认 `.env.ci`）。
- 避免破坏现有端口/路径习惯；需要变更时提供兼容层。
- 不直接修改自动产物目录外的系统资源。
- 引入新镜像/依赖前查阅官方实践与安全公告。

## 流程的优化目标
- 自动化优先：减少手工步骤，提升可重复性。
- 资源效率：缩短构建/启动时间，控制内存/存储占用。
- 运维可观测：日志、指标、告警覆盖关键环节。

## 质量标准
- 验证通过：相关脚本/流水线/容器可正常执行、停止、回滚。
- 权限最小化、凭据安全存储；端口/路径清晰可配置。
- 文档同步，包含升级与回滚指南。

## 后续动作
- 在 todowrite/phrase 记录变更、风险、观察窗口与需要关注的告警。
- 若对成本或性能有影响，安排后续复盘并量化收益。

# 数据 / Schema 变更 Workflow

适用：GraphQL SDL 变更、Neo4j 节点/关系口径调整、数据口径/因子计算规则、数据导入/校验逻辑。

## 开始前的分析方法
- 确定变更类型：新增字段/类型、语义调整、删除/迁移。
- 识别消费者：前端查询、后端 resolver/service、数据导出、回归测试。
- 评估数据影响：历史数据兼容性、迁移方案、填充策略、延迟/吞吐。
- 制定验证路径：至少 3 源对齐规则（若涉及外部数据）。

## 必须阅读的文档
- `AGENTS.md`、`docs/README.md`、`libs/schema/README.md`
- 相关 TRD（架构/Schema/数据流水线）、DRD（数据覆盖/校验）
- 现有 SDL (`libs/schema/schema.graphql`) 及对应调用方代码
- 当前迭代 `project/BRN-*/` 记录

## 流程 checklist
- [ ] 描述变更动机与预期消费场景（查询示例）。
- [ ] 设计 SDL/数据口径更新，含字段含义、单位、默认值。
- [ ] 评估兼容性与迁移：是否需要 fallback、数据回填脚本。
- [ ] 更新 Schema（SDL + 相关类型/常量），同步更新调用方。
- [ ] 更新/新增数据校验与多源对比规则。
- [ ] 编写/更新测试：Schema 断言、解析/序列化、数据校验。
- [ ] 运行相关测试与数据产物校验（含回归查询）。
- [ ] 更新文档：TRD/DRD/README 中的口径说明。

## 流程的强制约束
- 不破坏 SSOT：Schema 更改必须先落在 `libs/schema/schema.graphql`。
- 不删除字段而无迁移；弃用需提供 deprecation/迁移计划。
- 数据来源需 ≥3 源或空白处理；宁空勿错。
- 自动产物存放在 `x-data/` 或 `x-log/`，不直接入仓。

## 流程的优化目标
- 语义自描述：字段命名与注释能直接表达口径。
- 最小化迁移成本：兼容旧查询、提供明确升级路径。
- 数据质量优先：强化校验、延迟/缺失监控。

## 质量标准
- Schema、调用方、测试与文档一致；类型/单位明确。
- 测试通过，包含至少一个查询/解析用例覆盖变更字段。
- 数据校验规则落地，缺省/异常路径有定义。

## 后续动作
- 记录迁移步骤与回滚方案；如需数据回填，登记执行顺序。
- 在 todowrite/phrase 中登记已完成/遗留项与监控需要。

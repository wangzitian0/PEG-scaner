# 应用逻辑变更 Workflow

适用：前端/后端应用层代码、GraphQL resolver/service、交互与业务逻辑调整（不含 Schema 口径变更）。

## 开始前的分析方法
- 明确用户价值与受影响用户路径，识别入口/出口（API、UI 事件）。
- 列出调用链：UI → GraphQL → service → repo，确认边界与依赖。
- 评估风险点：向后兼容性、性能敏感路径、并发与错误处理。

## 必须阅读的文档
- `AGENTS.md`、`docs/README.md`、相关子目录 README
- `libs/schema/README.md` 与相关 SDL 片段（了解接口契约）
- 对应 PRD/TRD（如 `docs/specs/product/`、`docs/specs/tech/`）
- 当前迭代的 `project/BRN-*/README.md`、`prompt.md`

## 流程 checklist
- [ ] 定义需求与预期行为（含输入/输出/边界条件）。
- [ ] 选定切入点：定位文件与函数，列出受影响模块。
- [ ] 设计方案：接口、数据流、错误处理、日志/监控。
- [ ] 逐步编码，保持最小改动面。
- [ ] 编写/更新单元或集成测试；必要时增加回归用例。
- [ ] 运行相关测试（至少受影响模块 + `npm run lint:structure` 如涉及依赖边界）。
- [ ] 更新文档：README、index、相关 TRD/PRD。
- [ ] 自检：类型、异常、幂等性、性能。

## 流程的强制约束
- 不绕过 Schema/契约：接口更改需先评审 Schema 影响。
- 不引入与需求无关的抽象层；避免 scope creep。
- 所有新依赖需查阅官方实践；遵守 SSOT（不重复定义常量/类型）。
- 测试必须覆盖主要路径；无测试变更需给出理由。

## 流程的优化目标
- 尽可能向下兼容，避免破坏现有调用方。
- 代码可读性/可维护性优先：小函数、明确责任边界。
- 复用已有工具与模块，减少重复实现。

## 质量标准
- 测试通过且用例覆盖关键分支；无 ESLint/TypeScript 报错。
- 数据流、错误处理、日志语义一致；无 Magic Number。
- 文档同步更新，路径和命名与现有体系一致。

## 后续动作
- 在 todowrite/phrase 记录交付与未决风险。
- 若有潜在回归，创建回归用例/监控告警项。

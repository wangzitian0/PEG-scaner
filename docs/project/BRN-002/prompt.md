# BRN-002: 用户指令记录（SSOT）

## 初始指令（2024-11-29）

**用户**：
> 帮我写 BRN-005.schema.md，不超过 30 行。核心理念是下面的...
> [知识图谱概念在图数据库中的实现]

**AI 响应**：创建了 BRN-005.schema.md

---

**用户**：
> 让你来实现@BRN-002.graphql_protocol_decision.md
> 你先描述下，你大概的流程，每个流程会生成和改动哪些文件

**AI 响应**：提出 8 Phase 实施计划（环境准备 → Schema拆分 → 目录重构 → 数据层 → 业务层 → Resolver → FastAPI → 测试清理）

---

**用户**：
> 文档和流程呢？也就是docs

**AI 响应**：补充了完整的 docs 管理流程（Phase 0-7，包含 BRN/TRD/DRD 文档创建与更新）

---

**用户**：
> 我意识到一个问题，请你先统一项目编号。也就是 BRN 对应的 XRD 编号用一样的，减小理解成本

**AI 响应**：执行编号统一操作，PRD-001→PRD-000, TRD-001→TRD-000，创建 TRD-001/002/003, PRD-003

---

**用户**：
> 你认为每个文件应该重点记录什么？
> 比如我认为 TRD 应该重点是调用关系，怎么解耦，背景调研等等，而不是大段代码。

**AI 响应**：
- 更新 AGENTS.md 文档组织原则
- 明确：TRD 写架构图+伪代码（5-10行），不写完整实现
- 明确：DRD 关注数据运营（数据源、质量、BI），不是数据库 Schema

---

**用户**：
> data DRD 完全错了。他对应的是，公司运营层面的数据，不是基础产品数据和运营

**AI 响应**：
- 重新定义 DRD：业务数据需求、BI 分析、数据质量治理
- 数据库 Schema 属于 TRD（技术实现的数据层）

---

**用户**：
> specs/data/ -> specs/BI。BI 产出 DRD
> 你把整个 repo 先这么改了吧

**AI 响应**：
- 执行 `mv docs/specs/data docs/specs/BI`
- 更新所有相关文档引用
- 更新 AGENTS.md, arch.md, README 等

---

**用户**：
> 好，继续，把整个 docs 文件夹治理好

**AI 响应**：
- 创建 TRD-001/002/003, PRD-003（架构图+伪代码，无完整实现）
- 更新所有 README（级联更新）
- 更新 docs/index.md（索引总表）
- 完成所有交叉引用修正

---

**用户**：
> @BRN-002 让你实现这个，你先口述你打算怎么弄，以及会改动哪些文件

**AI 响应**：提出 7 Phase 实施计划（包含目录结构 `apps/backend/src/api/core/infra/`）

---

**用户**：
> 目录设计有点奇怪的地方是，nx 本身有 apps/这种结构了，为什么 backend/src/xxx 这里还有一层树形？

**AI 响应**：反思并提出 3 种方案（A: 扁平化+抽libs, B: backend内分层, C: 混合）

---

**用户**：
> 你为什么对 src 有执念？非 src 的东西不是应该已经去到 tools 了么

**AI 响应**：
- 认识到 `src/` 是多余的
- 推荐直接 `apps/backend/main.py`（去掉 src 层）

---

**用户**：
> 我要新写 etl，爬虫这些，你是希望放在 app/里面还是放在 app/backend 里面？

**AI 响应**：
- 推荐独立 App：`apps/crawler/`, `apps/etl/`
- 共享逻辑抽到 `libs/neo4j-repo/`
- 理由：职责清晰、部署灵活、资源隔离

---

**用户**：
> @BRN-002:13-29 独立 app 吧，重写整个，给你 15 行的 quota

**AI 响应**：
- 重写 BRN-002 目录结构（15行）
- 去掉 `src/`、去掉过度分层
- 明确 backend/crawler/etl 独立 + libs 共享

---

**用户**：
> 根据@BRN-002，把完整的 各种docs/ 设计写了吧。等我 review 完你再去改代码

**AI 响应**：（当前任务）创建完整文档设计

---

## 关键决策点

1. **编号统一**：BRN 编号统领，XRD 继承同编号
2. **文档职责**：TRD 写架构图+伪代码，DRD 写数据运营，PRD 写产品体验
3. **目录结构**：去掉 `src/`，独立 app（backend/crawler/etl），共享 libs
4. **迁移策略**：分阶段、保留旧代码、先 backend 后爬虫


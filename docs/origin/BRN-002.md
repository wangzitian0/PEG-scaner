# BRN-002: 协议与通信依赖（对应 TRD-002）
1) 协议：全链路以 GraphQL 作为数据契约，HTTP/JSON 封装传输；利用 Graph SDL 定义类型。
2) Schema：`libs/schema/*.graphql` 为唯一源 (SSOT)，前端生成 TypeScript 类型/Hooks，后端实现 Resolver。
3) 传输：移动/Web 走 HTTPS (GraphQL Query/Mutation)；服务端返回 JSON 格式的 Graph 结果。
4) 版本：Schema 演进式变更（新增字段不破坏旧查询），利用 GraphQL 自身的废弃机制 (`@deprecated`)。
5) 依赖：后端集成 Ariadne/Strawberry；前端集成 Apollo/TanStack Query；回归脚本使用 GraphQL Client。
6) 健康：`/api/ping` 返回 200 + 版本信息；`/graphql` 提供 Introspection (生产环境可选关闭)。
7) 安全：信任一层代理，校验 `X-Forwarded-*`；API 不缓存 (Mutation)，Query 可选持久化查询；鉴权/限流由反代或后端 Context 处理。
8) 监控：GraphQL 错误 (`errors` 数组) 需打点，日志入 `x-log/`；异常请求记录 Query 摘要。
9) 回滚：Schema 破坏性变更需慎重（通常只增不减），客户端容忍多余字段；发布前跑 `backend:test` 与回归。
10) 边界：禁止绕过 Schema 的 Ad-hoc JSON，所有数据交互必须定义在 `.graphql` 文件中。
